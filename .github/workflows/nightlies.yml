on: push
jobs:
  md_to_html:
    runs-on: ubuntu-18.04
    env:
      INFILE: ghactions-publishing.md
      OUTFILE: ghactions-publishing.html
    steps:
    - uses: actions/checkout@master
    - uses: docker://pandoc/core:2.9
      with:
        args: >-
          --standalone
          --output=${{ env.OUTFILE }}
            ${{ env.INFILE }}
    - run: echo OUTFILE=${{ env.OUTFILE }} >> $GITHUB_ENV
  curl:
    runs-on: ubuntu-latest
    needs: md_to_html
    steps:
    - run: echo ${{ env.OUTFILE }}
    - uses: actions/checkout@master
    - name: curl
      uses: wei/curl@v1
      with:
        args: --user ${{ secrets.NIGHTLIES_USER }}:${{ secrets.NIGHTLIES_TOKEN }} --upload-file ${{ env.OUTFILE }} https://nightlies.apache.org/ghactions-publishing.html
